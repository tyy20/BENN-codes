# Belted and Ensembled Neural Network (BENN) 

## Code description

These codes are provided to reproduce the simulation and application results in the paper **Belted and Ensembled Neural Network for Linear and Nonlinear Sufficient Dimension Reduction**.
This is a unified deep-learning-based framework for sufficient dimension reduction, which consists of a latent narrow layer (belt) and a family of transformations of the response (ensemble).
Placing the belt at different layers can achieve linear or nonlinear sufficient dimension reduction, while choosing different transformation families can incorporate dimension reduction for conditional distribution or conditional mean.

## Environment and requirements

### Environment

-  `torch_env` is an environment that includes pytorch and related packages. It can be replaced. 
```bash
module load anaconda3
conda init bash
source activate
conda activate torch_env
```

### Required files

- GMDDNet: `NSDR.py` `plotutils.py` (from the codes of Chen et al. (2024). https://doi.org/10.1214/24-AOS2390)
- StoNet: `model.py` `train_stonet.py` `tools.py` (from https://github.com/booml247/StoNet_SDR_NeurIPS)
- GSIR: `gsir.R` (from the codes in Chapter 13 of Li (2018))

### Required packages and versions

#### R version 4.2.1 (2022-06-23)

- attached base packages:   
  - `stats`  
  - `graphics` 
  - `grDevices` 
  - `utils` 
  - `datasets` 
  - `methods` 
  - `base`     
- other attached packages:  
  - `energy_1.7-12`

#### Python 3.11.5 (main, Sep 11 2023, 13:54:46) [GCC 11.2.0]

- standard library modules:
  - `math` 
  - `datetime` 
  - `os` 
  - `time` 
  - `errno` 
  - `copy` 
  - `warnings`
- imported packages:   
  - `numpy: 1.26.4` 
  - `pandas: 1.5.3` 
  - `torch: 2.4.1+cu121` 
  - `matplotlib: 3.8.0` 
  - `sklearn: 1.3.1` 
  - `pytorch_lightning: 2.0.9.post0` 
  - `dcor: 0.6` 
  - `argparse: 1.1` 
  - `scipy: 1.13.1` 
  - `_ctypes: 1.1.0`


## Data access

### Simulation datasets

In the simulation sections (Sections 6 and S.6), all datasets are generated by the corresponding codes in the folder `data-generation`.
All files in this subsection are located in the folder `data-generation`.

- **Models A--C** (Section S.6.1): 
  - Datasets for BENN and StoNet are generated by `data-generation-nonlinear-0.R`. 
  - Datasets for preliminary analysis are generated by `data-generation-nonlinear-0-prelim.R`. 
  - Results of GMDDNet and GSIR are from Results from GMDDNet and GSIR come from Chen et al. (2024). https://doi.org/10.1214/24-AOS2390
- **Model D-IV** (Sections 6, S.6.3 and S.6.6): 
  - Datasets for all methods are generated by `data-generation-nonlinear-1.R`. 
  - Datasets for preliminary analysis are generated by `data-generation-nonlinear-1-prelim.R`.
- **Model E-IV** (Sections S.6.2 and S.6.3): 
  - Datasets for all methods are generated by `data-generation-nonlinear-2.R`.
  - Datasets for preliminary analysis are generated by `data-generation-nonlinear-2-prelim.R`.
- **Model F-V** (Section S.6.5): 
  - Datasets for all methods are generated by `data-generation-linear-3.R`.
  - Datasets for preliminary analysis are generated by `data-generation-linear-3-prelim.R`.
- **Model G-IV** (Section S.6.6): 
  - Datasets for all methods are generated by `data-generation-nonlinear-4.R`.
  - Datasets for preliminary analysis are generated by `data-generation-nonlinear-4-prelim.R`.


### Application datasets

- **Superconductivty dataset** (Sections 7 and S.7)
  - Original data source: https://archive.ics.uci.edu/dataset/464/superconductivty+data
  - Dataset file: `application-1/train.csv` (downloaded from the original source)
- **Geographical origin of music dataset** (Section S.8)
  - Original data source: https://archive.ics.uci.edu/dataset/315/geographical+original+of+music
  - Dataset file: `application-2/default_features_1059_tracks.txt` (downloaded from the original source)
  

  
## Codes

### Main codes for implementation

We provide two files of main codes with comments: `benn-main-code-kernel.ipynb` and `benn-main-code-poly.ipynb`, which utilizes Gaussian kernels and polynomials as ensemble transformations, respectively.

### Simulation codes

Simulation codes are placed in different folders, with detailed instructions in the `README.md` file in each folder.

- **Models A--C** (Section S.6.1): Refer to folder `simulation-model-ABC`
- **Model D-IV** (Sections 6, S.6.3 and S.6.6): Refer to folder `simulation-model-D-IV`.
- **Model E-IV** (Sections S.6.2 and S.6.3): Refer to folder `simulation-model-E-IV`.
- **Model F-V** (Section S.6.5): Refer to folder `simulation-model-F-V`.
- **Sensitivity analysis** (Section S.6.4): Refer to folder `sensitivity-analysis`
- **Additional comparisons with GMDDNet** (Section S.6.6): Refer to folders `gmdd-comp-D-IV` and `gmdd-comp-G-IV`


### Application codes

Application codes are placed in different folders, with detailed instructions in the `README.md` file in each folder.

- **Superconductivty dataset** (Sections 7 and S.7): Refer to folder `application-1`.
- **Geographical origin of music dataset** (Section S.8): Refer to folder `application-2`.



## Tables and figures reproduced

### Tables for simulations

- **Table S.1**: Run the algorithms in the folder `simulation-model-ABC`, and run `results-summary-model123-final.R` to reproduce the table.
- **Table 1**: Run the algorithms in the folder `simulation-model-D-IV`, and run `results-summary-model4-1-final.R` to reproduce the table.
- **Table S.3**: Run the algorithms in the folder `simulation-model-D-IV`, and run `time-summary-model4-1.R` to reproduce the table.
- **Table S.2**: Run the algorithms in the folder `simulation-model-E-IV`, and run `results-summary-model4-2-final.R` to reproduce the table.
- **Table S.4**: Run the algorithms in the folder `simulation-model-E-IV`, and run `time-summary-model4-2.R` to reproduce the table.
- **Table S.5**: Run the algorithms in the folder `sensitivity-analysis`, and run `results-summary-sensitivity.R` to reproduce the table.
- **Table S.6**: Run the algorithms in the folder `simulation-model-F-V`, and run `results-summary-model5-3-correct.R` to reproduce the table.
- **Table S.7**: Run the algorithms in the folders `simulation-model-D-IV` and `gmdd-comp-D-IV`, and run `results-summary-gmdd-model4-1-ymode.R` to reproduce the table.
- **Table S.8**: Run the algorithms in the folder `gmdd-comp-G-IV`, and run `results-summary-gmdd-model4-4-ymode.R` to reproduce the table.


### Tables and Figures for applications

- **Figures 4, S.1--S.8**: Run the algorithms in the folder `application-1`.
- **Table S.9**: Run the algorithms in the folder `application-1`, and run `application-1-result-summary.R` to reproduce the table.
- **Figures S.9--S.12**: Run the algorithms in the folder `application-2`.


## Remarks

- In each subdirectory for different simulation settings, two subfolders are provided.
  - `implementation` folder includes the methodology implementation codes;
  - `result` folder includes the codes to summarize the results and reproduce the tables.
- The running times are roughly estimated based on the JupyterLab with 8 cores and 16GB memory, unless explicitly marked as CPU times.
